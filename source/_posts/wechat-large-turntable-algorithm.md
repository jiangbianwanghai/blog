---
title: 基于微信的大转盘抽奖算法研究
date: 2021-08-23 12:09:14
tags: ["算法", "PHP"]
---

基于微信的大转盘抽奖功能想必大家都体验过。那么，它们中奖的概率是怎么算的呢？

其实，抽奖的算法主要包含：

1. 中奖概率的问题。大奖概率不能过高，不然会亏本。中奖概率也不能过低，不然不利于推广。
1. 用户人群的问题。奖项在什么时间会出现，如果出现的过早的活动的效果大打折扣，如果太晚可能奖品就发不完。
1. 超发的问题。在并发情况下，可能存在A和B同时中奖的问题。

基于上述问题。

设定时间线。奖品可以均匀的分步。

使用redis的原子性还解决并发和超发的问题。


抽中

扣奖品库存

直到奖项记录被写入记录表才能说明此用户获奖了。

##### 不可控

设定奖池大小，直接将奖品注入奖池。每抽一次，将此的奖券减少一张，直到奖券全部抽完，抽奖才算结束。

这个过程有可能奖品中完了，无效的奖券还没有抽完。

##### 可控

设定一个奖池，奖池是带有时间戳。只有时间戳在这个范围内中奖的才能算中奖。

其实很简单

直接将奖品放入奖池，用随机数，如果随机数跟奖品匹配，则中奖。如果需要设定中奖是时间，可以先判断时间。
如果需要设置中奖的概率，也可以设定，参与人数达到多少出奖品。

上面是我一开始研究抽奖功能的思路，跟实际开发出的效果还是区别蛮大的。

最大的差异是摒弃了奖池的概念，虽然奖池是最接近模拟真实场景的，但这并不是一个好的思路。

开发一个抽奖产品，最重要的是可控。首先是奖项的中奖概率是可控的。

概率大一点儿，中奖的人数就多。概率小一点儿中奖的人数就少。

还是奖品投放数量的要求。可以随时追加奖品数量。

在真实的运营活动中，一个好的工具是可以帮助运营者达到活动目标效果的。

那么，中奖算法该怎么设计呢？

我是这么设计的

加入抽奖活动发布者，发布了一个活动，奖品分别是一等奖、二等奖、三等奖

那么，随机数的随机范围则是1-4，1代表一等奖，2代表二等奖，3代表三等奖，4代表空奖（谢谢参与）

```
rand(1, 4)
```
如果活动参与者抽中4号则直接返回空奖，如果抽中2号，则按照2号的抽奖概率来计算随机数。

假设，2号的中奖概率是千分之47。那么，随机数的输出范围就是1-1000，如果输出的数字小于47则中奖，大于47则不中奖。

这样就能随意的调整中奖概率了。可大可小。下面是一段伪代码

```
$rand = rand(1, 4);
if ($rand == 2) {
    $rand = rand(1, 1000);
    if ($rand <= 47) {
        echo '恭喜你中奖了';
    } else {
        echo '谢谢参与';
    }
} else {
    echo '谢谢参与';
}

```
